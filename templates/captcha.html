<head>
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <script>
        // you need to replace this code
        // with modern version, i've recommend you 
        // to use smth like axios
        function onSubmit(token) {
            const userId = {{ user_id }};
            let publicKey = "{{ user_public_key }}";

            const http = new XMLHttpRequest();
            const url = '/captcha'; // our fastapi webapi callback
            http.open('POST', url, true);

            http.setRequestHeader('Content-type', 'application/json');
            
            // call a function when the state changes.
            http.onreadystatechange = function() 
            {
                if(http.readyState == 4) 
                {
                    const responseBody = JSON.parse(http.responseText)

                    document.querySelector('#title').innerText = responseBody.detail;
                    if (http.status == 200) 
                    {
                        // document.querySelector('#captcha').remove();
                        // here we understand that everything is ok
                    }
                }
            }
            const params = {
                'token': token,
                'user_id': userId,
                'public_key': publicKey,
            };

            http.send(JSON.stringify(params));
        }
    </script>
</head>
<body>
    <h3>Hello, {{ first_name }}</h3>
    <h3 id="title">Do Androids Dream of Electric Sheep?</h3>
    <div id="captcha" class="g-recaptcha" data-callback='onSubmit' data-sitekey="{{recaptcha_public_key}}"></div>
</body>
